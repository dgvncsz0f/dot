; -*- mode: emacs-lisp; -*-

(require 'custom)
(require 'server)
(require 'uniquify)
(require 'package)
(require 'midnight)

(when (>= emacs-major-version 24)
  (package-initialize)
  (add-to-list 'package-archives '("marmalade" . "http://marmalade-repo.org/packages/") t)
  (add-to-list 'package-archives '("melpa" . "http://melpa.milkbox.net/packages/") t)
  (when (not package-archive-contents) (package-refresh-contents)))

(unless (boundp 'user-emacs-directory)
  (setq user-emacs-directory "~/.emacs.d/"))

(let ((user-site-lisp-dir (concat user-emacs-directory "share/emacs/site-lisp/"))
      (user-theme-dir (concat user-emacs-directory "themes/"))
      (user-site-start-dir (concat user-emacs-directory "libexec/emacs/site-start.d/")))
  (add-to-list 'custom-theme-load-path user-theme-dir)
  (let ((default-directory user-site-lisp-dir))
    (normal-top-level-add-to-load-path '("."))
    (normal-top-level-add-subdirs-to-load-path))
  (mapcar 'load (file-expand-wildcards (concat user-site-start-dir "*.el"))))

(set-default-font "Ubuntu Mono")
(set-face-attribute 'default nil :height 160)

(fset 'yes-or-no-p 'y-or-n-p)

(midnight-delay-set 'midnight-delay 0)
(setq magit-last-seen-setup-instructions "1.4.0")
(setq enable-remote-dir-locals t)
(setq echo-keystrokes 0.1)
(setq vc-mode t)
(setq ssl-program-name "gnutls-cli")
(setq ssl-program-arguments '("--insecure" "--port" service "--x509cafile" "/etc/ssl/certs/ca-certificates.crt" host))
(setq-default indent-tabs-mode nil)
(setq backup-inhibited t)
(setq tags-revert-without-query t)
(setq auto-save-default nil)
(setq blink-matching-paren t)
(setq inhibit-startup-screen t)
(setq modeline-shadow-thickness 0)
(setq comment-multi-line t)
(setq mail-from-style 'angles)
(setq kill-whole-line t)
(setq uniquify-buffer-name-style 'post-forward)
(setq uniquify-strip-common-suffix nil)
(setq custom-file "~/.emacs.d/custom-file")
(setq dired-hide-details-hide-symlink-targets nil)

(put 'erase-buffer 'disabled nil)
(put 'narrow-to-region 'disabled nil)
(put 'dired-find-alternate-file 'disabled nil)
(put 'scroll-left 'disabled nil)
(put 'downcase-region 'disabled nil)
(put 'upcase-region 'disabled nil)
(put 'set-goal-column 'disabled nil)

(load-theme 'solarized t)
(use-solarized-bgmode nil 'dark)
(add-hook 'after-make-frame-functions
          (lambda (frame) (use-solarized-bgmode frame 'dark)))

(set-scroll-bar-mode nil)
(menu-bar-mode 0)
(tool-bar-mode 0)

(when (file-exists-p custom-file) (load custom-file))

(show-paren-mode t)
(size-indication-mode t)
(column-number-mode t)
(global-font-lock-mode t)
(global-linum-mode t)
(global-hl-line-mode t)
(global-visual-line-mode t)
(global-subword-mode t)
(transient-mark-mode t)
(global-set-key (kbd "<C-return>") 'rectangle-mark-mode)
(global-set-key (kbd "C-c ro") 'open-rectangle)

;; indentation
(c-add-style "dgvncsz0f" '("bsd"
                           (c-basic-offset . 2)
                           (substatement-open . 0)
                           ))
(add-hook 'c-mode-hook
          (lambda () (c-set-style "dgvncsz0f")))
(add-hook 'c++-mode-hook
          (lambda () (c-set-style "dgvncsz0f"))
(add-hook 'c-mode-common-hook
          (lambda ()
            (setq c-basic-offset 2)
            (setq c-set-style "bsd")))
(add-hook 'js-mode-hook
          (lambda () (setq js-indent-level 2)))
(add-hook 'sh-mode-hook
          (lambda () (setq sh-basic-offset 2)))
(add-hook 'python-mode-hook
          (lambda ()
            (setq py-indent-offset 2)
            (modify-syntax-entry ?_ "_")))

;; keybinds
(add-hook 'dired-mode-hook (lambda () (define-key dired-mode-map (kbd "M-g") 'ag)))
(global-set-key (kbd "<f5>") 'ispell-change-dictionary)
(global-set-key (kbd "<f6>") 'column-highlight-mode)
(global-set-key (kbd "<f7>") 'visual-line-mode)
(global-set-key (kbd "<f8>") 'magit-status)
(global-set-key (kbd "S-<f5>") 'my-toggle-flyspell)
(global-set-key (kbd "S-<f6>") 'whitespace-mode)
(global-set-key (kbd "S-<f7>") 'toggle-truncate-lines)
(global-set-key (kbd "S-<f8>") 'magit-blame)
(global-set-key (kbd "C-x o") 'ace-window)
(global-set-key (kbd "C-c SPC") 'ace-jump-mode)
(global-set-key (kbd "C-x SPC") 'ace-jump-mode-pop-mark)
(global-set-key (kbd "M-z") 'ace-jump-zap-to-char)
(global-set-key (kbd "M-Z") 'ace-jump-zap-up-to-char)
(global-set-key (kbd "C-c o") 'occur)
(global-set-key (kbd "C-c s") 'my-open-shell-sideways)
(global-set-key (kbd "C-c c") 'describe-char)
(global-set-key (kbd "C-S-o") 'my-prepend-line)
(global-set-key (kbd "C-c U") 'browse-url-at-point)
(global-set-key (kbd "C-c u") 'browse-url)
(global-set-key (kbd "C-S-r") 'revert-buffer)
(global-set-key (kbd "C-o") 'my-append-line)
(global-set-key (kbd "C-x D") 'find-name-dired)
(global-set-key (kbd "C-k") 'kill-whole-line)
(global-set-key (kbd "C-M-k") 'kill-line)
(global-set-key (kbd "M-n") 'next-error)
(global-set-key (kbd "M-p") 'previous-error)
(global-set-key (kbd "M-<up>") 'scroll-down)
(global-set-key (kbd "M-<down>") 'scroll-up)
(global-set-key (kbd "M-<right>") 'move-end-of-line)
(global-set-key (kbd "M-<left>") 'move-beginning-of-line)
(global-set-key (kbd "C-c C-x C-e") 'eval-and-replace)
(global-set-key (kbd "<C-return>") 'rectangle-mark-mode)
(global-set-key (kbd "C-c ro") 'open-rectangle)
(global-set-key (kbd "C-c C-SPC") 'erc-track-switch-buffer)

(unless (server-running-p) (server-start))
