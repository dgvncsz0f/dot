#!/bin/bash

source $HOME/.dot/bin/pwdcnf

site=$(/usr/bin/basename $1)
pws_path "$site"

while true
do
  IFS=$'\n'
  read -s -p 'Password: ' nextpwd
  echo
  read -s -p 'Password (confirm): ' nextpwd2
  if [ "$nextpwd" != "$nextpwd2" ]
  then
    echo "  password mismatch o.O"
  else
    echo
    read -n 1 -p "accept [passwd='$nextpwd'] [y|n|q]? " take_this
    if [ "$take_this" == "y" ]
    then
      echo "$nextpwd" | /usr/bin/gpg -e > "$pws_path"
      /bin/chmod 600 "$pws_path"
      $binroot/pwdfor "$site"
      exit 0
    elif [ "$take_this" == "q" ]
    then
      exit 0
    fi
  fi
  echo
done
