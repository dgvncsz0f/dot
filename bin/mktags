#!/bin/sh

suffixes="py hh h cc c java el l cl pl pm hs rb js"

bin_find=${bin_find:-/usr/bin/find}
bin_ctags=${bin_etags:-/usr/bin/ctags-exuberant}
bin_notifysend=${bin_notifysend:-/usr/bin/notify-send}
bin_env=${bin_env:-/usr/bin/env}

srcroot=$1
event=$2

mktags_runetags()
{
  $bin_ctags -e -o "$srcroot/TAGS" -L-
}

mktags_runctags()
{
  $bin_ctags -o "$srcroot/tags" -L-
}

mktags_notify()
{
  $bin_env DISPLAY=:0 $bin_notifysend \
    --icon=dialog-information \
    "mktags: $srcroot" \
    2>/dev/null
}

mktags_gather()
{
  for suffix in $suffixes
  do
    find "$srcroot" -type f -name "*.$suffix"
  done
}

mktags_should_ignore()
{
  [ "$event" = "$srcroot/TAGS" ] && return 0
  [ "$event" = "$srcroot/tags" ] && return 0
  return 1
}

mktags_run()
{
  { mktags_gather | mktags_runetags; } && { mktags_gather | mktags_runctags; } && mktags_notify;
}

mktags_should_ignore || mktags_run
